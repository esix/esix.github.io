import"./modulepreload-polyfill-B5Qt9EMX.js";const Rt=-.4,nt=50,st=80,it=60,lt=37.5,ot=15,rt=12;let ht=nt,ct=st,w=it,ft=lt,Y=ot,x=rt,W,q,at,O,I,J;function ut(){W=ft/w,q=W*W-2*W+1,at=1/q,O=Math.ceil(w),I=2*O,J=new Float64Array(I*I);for(let n=0;n<I;n++)for(let e=0;e<I;e++){const t=Math.hypot(n-O,e-O);if(t<w){const s=t/w;J[n*I+e]=(s*s-2*s+1)/q}}}function It(n){ht=nt*n,ct=st*n,w=it*n,ft=lt*n,Y=ot*n,x=Math.max(4,Math.round(rt*n)),ut()}ut();function yt(n,e,t,s,i){const l=s-n+O|0,o=i-e+O|0;return l<0||l>=I||o<0||o>=I?0:J[l*I+o]*t}class St{constructor(e,t){this.x=e,this.y=t,this.ratio=1,this.cluster=null,this.prevCluster=null}pick(e,t){return Math.abs(e-this.x)<=Y&&Math.abs(t-this.y)<=Y}draw(e,t){const s=Y;e.fillStyle="#ffff80",e.fillRect(this.x-s,this.y-s,2*s,2*s),e.lineWidth=1,e.strokeStyle="#000",e.strokeRect(this.x-s,this.y-s,2*s,2*s),t&&(e.lineWidth=2,e.strokeStyle="#f00",e.strokeRect(this.x-s,this.y-s,2*s,2*s))}}let F=0,T=0,S=null,H=null,z=null;function dt(n,e){F=Math.floor(n/x)+3,T=Math.floor(e/x)+3,S=Array.from({length:F+2},()=>new Float64Array(T+2)),H=Array.from({length:F+2},()=>new Array(T+2).fill(null)),z=Array.from({length:F+2},()=>new Array(T+2).fill(null))}function xt(n){return n*x-x}function kt(n){return n*x-x}class pt{constructor(e,t,s,i){this.u0=e,this.v0=t,this.u1=s,this.v1=i,this.edgeIn=null,this.edgeOut=null}vertex(){const e=S[this.u0][this.v0],t=S[this.u1][this.v1],s=Math.abs(1-e)/Math.abs(t-e);return{x:xt(this.u0*(1-s)+this.u1*s),y:kt(this.v0*(1-s)+this.v1*s)}}oppositeEdge(e){return this.edgeIn===e?this.edgeOut:this.edgeIn}}function h(n,e){return H[n][e]??(H[n][e]=new pt(n,e,n+1,e))}function c(n,e){return z[n][e]??(z[n][e]=new pt(n,e,n,e+1))}class f{constructor(e,t){this.v0=e,this.v1=t,this.deleted=!1,e.edgeOut=this,t.edgeIn=this}opposite(e){return e===this.v0?this.v1:this.v0}}function _t(n,e,t){const s=S[e][t],i=S[e+1][t],l=S[e][t+1],o=S[e+1][t+1];switch((s>1?8:0)|(i>1?4:0)|(l>1?2:0)|(o>1?1:0)){case 0:case 15:break;case 8:n.push(new f(h(e,t),c(e,t)));break;case 4:n.push(new f(c(e+1,t),h(e,t)));break;case 2:n.push(new f(c(e,t),h(e,t+1)));break;case 1:n.push(new f(h(e,t+1),c(e+1,t)));break;case 12:n.push(new f(c(e+1,t),c(e,t)));break;case 10:n.push(new f(h(e,t),h(e,t+1)));break;case 5:n.push(new f(h(e,t+1),h(e,t)));break;case 3:n.push(new f(c(e,t),c(e+1,t)));break;case 7:n.push(new f(c(e,t),h(e,t)));break;case 11:n.push(new f(h(e,t),c(e+1,t)));break;case 13:n.push(new f(h(e,t+1),c(e,t)));break;case 14:n.push(new f(c(e+1,t),h(e,t+1)));break;case 9:{s+i+l+o>4?(n.push(new f(h(e,t),c(e+1,t))),n.push(new f(h(e,t+1),c(e,t)))):(n.push(new f(h(e,t),c(e,t))),n.push(new f(h(e,t+1),c(e+1,t))));break}case 6:{s+i+l+o>4?(n.push(new f(c(e,t),h(e,t))),n.push(new f(c(e+1,t),h(e,t+1)))):(n.push(new f(c(e+1,t),h(e,t))),n.push(new f(c(e,t),h(e,t+1))));break}}}function Lt(n){const e=[];let t=n,s=t.v0;for(;e.push(s.vertex()),t.deleted=!0,s=t.opposite(s),t=s.oppositeEdge(t),!(!t||t===n););return e}function Ct(n){if(n.length<3)return n;const e=[];for(let t=0;t<n.length;t++){const s=n[(t-1+n.length)%n.length],i=n[t],l=n[(t+1)%n.length];e.push({x:(i.x+(s.x+l.x)/2)/2,y:(i.y+(s.y+l.y)/2)/2})}return e}function Nt(n,e,t,s,i){const l=Math.max(0,Math.floor(e/x)),o=Math.min(F,Math.ceil(s/x)+2),b=Math.max(0,Math.floor(t/x)),p=Math.min(T,Math.ceil(i/x)+2);for(let r=l;r<=o;r++)for(let E=b;E<=p;E++)S[r][E]=0,H[r][E]=null,z[r][E]=null;for(const r of n){const E=Math.max(l,Math.floor((r.x-w)/x)),bt=Math.min(o,Math.ceil((r.x+w)/x)+1),Et=Math.max(b,Math.floor((r.y-w)/x)),At=Math.min(p,Math.ceil((r.y+w)/x)+1);for(let P=E;P<=bt;P++)for(let U=Et;U<=At;U++)S[P][U]+=yt(r.x,r.y,r.ratio,xt(P),kt(U))}const A=[];for(let r=l;r<o;r++)for(let E=b;E<p;E++)_t(A,r,E);const v=[];for(const r of A)r.deleted||v.push(Lt(r));return v}let j=!0;const Ot="#c8e8ff",tt="#0080ff";class Bt{constructor(){this.kernels=[],this.boundary=null,this.holes=[],this.dirty=!1}addKernel(e){e.cluster=this,this.kernels.push(e)}kernelBBox(){let e=1/0,t=1/0,s=-1/0,i=-1/0;for(const l of this.kernels)e=Math.min(e,l.x),t=Math.min(t,l.y),s=Math.max(s,l.x),i=Math.max(i,l.y);return{x0:e-w,y0:t-w,x1:s+w,y1:i+w}}updateGeometry(e){if(this.kernels.length===0){this.boundary=null,this.holes=[];return}for(const i of e)i.ratio=Rt;for(const i of this.kernels)i.ratio=1;for(const i of this.kernels){let l=0;for(const o of e)l+=yt(o.x,o.y,o.ratio,i.x,i.y);l>.001&&(i.ratio=at/l)}const t=this.kernelBBox(),s=Nt(e,t.x0,t.y0,t.x1,t.y1).map(Ct);if(s.length===0){this.boundary=null,this.holes=[];return}s.sort((i,l)=>l.length-i.length),this.boundary=s[0],this.holes=s.slice(1)}pick(e,t){return this.boundary!==null&&Q(this.boundary,e,t)&&!this.holes.some(s=>Q(s,e,t))}paint(e){if(this.boundary){if(j){X(e,this.boundary,Ot,null);for(const t of this.holes)X(e,t,"#fff",null)}X(e,this.boundary,null,tt);for(const t of this.holes)X(e,t,null,tt)}}}function X(n,e,t,s){if(!(!e||e.length<2)){n.beginPath(),n.moveTo(e[0].x,e[0].y);for(let i=1;i<e.length;i++)n.lineTo(e[i].x,e[i].y);n.closePath(),t&&(n.fillStyle=t,n.fill()),s&&(n.strokeStyle=s,n.lineWidth=2,n.stroke())}}function Q(n,e,t){let s=!1;for(let i=0,l=n.length-1;i<n.length;l=i++){const o=n[i].x,b=n[i].y,p=n[l].x,A=n[l].y;b>t!=A>t&&e<(p-o)*(t-b)/(A-b)+o&&(s=!s)}return s}function V(n){for(const t of n)t.prevCluster=t.cluster;const e=n.map(t=>{const s=new Bt;return s.kernels=[t],t.cluster=s,s});for(let t=0;t<n.length;t++)for(let s=0;s<t;s++){const i=n[t],l=n[s];if(i.cluster===l.cluster)continue;const o=i.prevCluster===l.prevCluster?ct:ht;Math.hypot(i.x-l.x,i.y-l.y)<o&&Dt(i.cluster,l.cluster,e)}for(const t of e)t.updateGeometry(n);return e}function Dt(n,e,t){const[s,i]=n.kernels.length>=e.kernels.length?[n,e]:[e,n];for(const o of i.kernels)o.cluster=s,s.kernels.push(o);const l=t.indexOf(i);l>=0&&t.splice(l,1)}function Ft(n,e){const t=n.map(s=>({x:s.x,y:s.y}));for(let s=0;s<20;s++)for(let i=0;i<t.length;i++)for(let l=i+1;l<t.length;l++){const o=t[l].x-t[i].x,b=t[l].y-t[i].y,p=Math.hypot(o,b)||.001;if(p<e){const A=(e-p)/2;t[i].x-=o/p*A,t[i].y-=b/p*A,t[l].x+=o/p*A,t[l].y+=b/p*A}}return t}let R=null,B=null,Z=null,N=0,G=!0,$=null;function Tt(n){R=n,B=n.kernels.map(t=>({x:t.x,y:t.y}));let e=[...B];for(let t=0;t<10;t++)e=Ft(e,35);Z=e,N=0,G=!0,$&&cancelAnimationFrame($),mt()}function mt(){if(N+=G?1:-1,G&&N>=10&&(N=10,G=!1),!G&&N<=0){for(let t=0;t<R.kernels.length;t++)R.kernels[t].x=B[t].x,R.kernels[t].y=B[t].y;C=V(u),R=null,d();return}const n=N/10,e=-2*n**3+3*n**2;for(let t=0;t<R.kernels.length;t++)a.includes(R.kernels[t])||(R.kernels[t].x=B[t].x*(1-e)+Z[t].x*e,R.kernels[t].y=B[t].y*(1-e)+Z[t].y*e);R.updateGeometry(u),d(),$=requestAnimationFrame(mt)}const Gt=[[538,358],[496,371],[522,360],[553,383],[432,388],[414,396],[487,128],[495,147],[507,114],[521,137],[510,168],[548,151],[93,352],[78,357],[86,369],[128,105],[105,98],[126,76],[229,237],[287,283],[310,259],[284,245],[270,268],[257,261],[232,281],[300,267],[273,249],[241,246],[270,222],[172,77]];let u=[],C=[],D=!0,a=[],K={x:0,y:0},_=0,k=null,g=null,M=null,L=!1;const y=document.getElementById("canvas"),m=y.getContext("2d");function gt(){y.width=window.innerWidth,y.height=window.innerHeight,dt(y.width,y.height)}window.addEventListener("resize",()=>{gt(),Ut()});function Mt(){const n=Math.min(y.width/1024,y.height/700);It(n),dt(y.width,y.height);const e=(y.width-1024*n)/2,t=(y.height-700*n)/2;u=Gt.map(([s,i])=>new St(s*n+e,i*n+t)),C=V(u)}function Pt(){u=[],C=[],a=[]}function Ut(){u.length>0&&(C=V(u)),d()}function d(){if(m.fillStyle="#fff",m.fillRect(0,0,y.width,y.height),D)for(const n of C)n.paint(m);for(const n of u)n.draw(m,a.includes(n));if(k&&k.length>1){m.beginPath(),m.moveTo(k[0].x,k[0].y);for(let n=1;n<k.length;n++)m.lineTo(k[n].x,k[n].y);m.strokeStyle="#f00",m.lineWidth=2,m.stroke()}g&&M&&(m.strokeStyle="#f00",m.lineWidth=2,m.strokeRect(Math.min(g.x,M.x),Math.min(g.y,M.y),Math.abs(g.x-M.x),Math.abs(g.y-M.y)))}function Wt(n,e){for(let t=u.length-1;t>=0;t--)if(u[t].pick(n,e))return u[t];return null}function wt(n,e){for(const t of u)if(t.pick(n,e))return null;for(const t of C)if(t.pick(n,e))return t;return null}function et(n,e){for(const t of a)u.splice(u.indexOf(t),1),u.push(t);K={x:n,y:e}}function Xt(n,e){const t=n-K.x,s=e-K.y;for(const i of a)i.x+=t,i.y+=s;K={x:n,y:e},C=V(u),d()}function Yt(){L||(a=[])}function jt(n){return n.length<5?!1:Math.hypot(n[0].x-n[n.length-1].x,n[0].y-n[n.length-1].y)<40}function Kt(){if(k){if(k.length>2&&jt(k)){L||(a=[]);for(const n of u)Q(k,n.x,n.y)&&!a.includes(n)&&a.push(n)}k=null,d()}}function Ht(){if(!g||!M){g=null;return}const n=Math.min(g.x,M.x),e=Math.min(g.y,M.y),t=Math.max(g.x,M.x),s=Math.max(g.y,M.y);g=M=null,L||(a=[]);for(const i of u)i.x>=n&&i.x<=t&&i.y>=e&&i.y<=s&&!a.includes(i)&&a.push(i);d()}y.addEventListener("mousedown",n=>{const e=n.clientX,t=n.clientY;L=n.shiftKey;const s=Wt(e,t);if(s){_=1,a.includes(s)||(L||(a=[]),a.push(s)),et(e,t),d();return}if(D){const i=wt(e,t);if(i){_=2,L||(a=[]);for(const l of i.kernels)a.includes(l)||a.push(l);et(e,t),d();return}_=4,L||(a=[]),k=[{x:e,y:t}]}else _=5,g={x:e,y:t},M={x:e+1,y:t+1};d(),n.preventDefault()});y.addEventListener("mousemove",n=>{const e=n.clientX,t=n.clientY;switch(_){case 1:case 2:Xt(e,t);break;case 4:k&&(k.push({x:e,y:t}),d());break;case 5:M={x:e,y:t},d();break}});y.addEventListener("mouseup",()=>{switch(_){case 1:case 2:Yt();break;case 4:Kt();break;case 5:Ht();break}_=0,d()});y.addEventListener("dblclick",n=>{if(!D)return;const e=wt(n.clientX,n.clientY);e&&e.kernels.length>0&&Tt(e)});y.addEventListener("contextmenu",n=>n.preventDefault());document.getElementById("btnClear").addEventListener("click",()=>{u.length===0?Mt():Pt(),d()});document.getElementById("btnShow").addEventListener("click",function(){D=!D,this.textContent=D?"Hide clusters":"Show clusters",d()});document.getElementById("btnFill").addEventListener("click",function(){j=!j,this.textContent=j?"Outline only":"Fill clusters",d()});gt();Mt();d();
